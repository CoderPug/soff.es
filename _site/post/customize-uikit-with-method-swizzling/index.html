<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <title>samsoff.es - Customize UIKit with Method Swizzling</title>
    <link href="http://feeds.feedburner.com/samsoffes/blog" rel="alternate" title="samsoff.es" type="application/atom+xml" />
    <link href="http://feeds.feedburner.com/samsoffes/the-experiment" rel="alternate" title="The Experiment Podcast" type="application/atom+xml" />
    <link href="/stylesheets/application.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/iphone.css" media="only screen and (max-device-width: 480px)" rel="stylesheet" type="text/css" />
    <link href="/stylesheets/pygments.css" media="screen" rel="stylesheet" type="text/css" />
    <meta name="viewport" content="width=320, user-scalable=no" />
    <script>var _gaq=_gaq || [];_gaq.push(['_setAccount','UA-5609322-1']);_gaq.push(['_trackPageview']);(function(){var ga=document.createElement('script');ga.async=true;ga.src=('https:'==document.location.protocol?'https://ssl':'http://www')+'.google-analytics.com/ga.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);})();</script>
    <script src="/javascripts/application.js"></script>
  </head>
  <body>
    <div id="border"></div>
    <div class="wrapper">
    	<div id="header" class="clear">
    		<h1><a href="/">sam<span>soff.es</span></a></h1>
    		<div>
      		<ul class="clear">
      			<li class="blog"><a href="/">Blog</a></li>
      			<li class="music"><a href="/music">Music</a></li>
      			<li class="about"><a href="/about">About</a></li>
      		</ul>
      	</div>
    	</div>
    	    	
      
<div class="post">
  <div class="title">
    <h2><a href="/post/customize-uikit-with-method-swizzling">Customize UIKit with Method Swizzling</a></h2>
    <p class="meta">Posted 12 Nov 2009</p>
  </div>
  <div class="content">
    <p>Have you ever wanted to override some functionality in UIKit that was in a hard to reach place? A lot of applications on the App Store have custom <code>UINavigationBar</code>'s. I really wanted to do this one of <a href="http://tastefulworks.com">my company</a>'s upcoming apps.</p>

<p>A popular solution for this creating a category and overriding the method you want to change in it. For this the example, we'll make a <code>UINavigationBar</code> green instead (obviously you could do something cool here instead). The category way would look something like this:</p>

<p>Liquid error: No such file or directory - pygmentize -l c -O encoding=utf-8 -f html</p>

<p>This approach works very well, but there are two issues with it: overriding methods with a category is an Objective-C no no and if you need to call the default implementation, you can't.</p>

<p>In my app, I wanted to change most of the navigation bars in all of the navigation controllers. I am using a <code>UIImagePickerController</code> in part of the app and it was customized to. I really wanted to keep it the translucent style instead of the style for the rest of my app.</p>

<p>I decided any <code>UINavigationBar</code> with <code>UIBarStyleDefault</code> as its style, I want to override and everything else leave alone. There is no way to do this with the category approach. You can't call <code>[self drawRect:rect]</code> because it would infinitely call itself since you replaced it with the method you are calling it from.</p>

<h3>Method swizzling</h3>

<p>After some googling and some help from #macdev on Freenode, I changed my solution to use method swizzling. <a href="http://www.cocoadev.com/index.pl?MethodSwizzling">Method swizzling</a>, in short, is switching methods at runtime. So you can say for <code>UINavigationBar</code> don't use the standard <code>drawRect:</code>, but instead swap it with a different one. (This is kinda confusing, but hang in there. It's not that hard.)</p>

<p>I updated my category to look like this:</p>

<p>Liquid error: No such file or directory - pygmentize -l c -O encoding=utf-8 -f html</p>

<p>I then updated <code>main.m</code> to look like this:</p>

<p>Liquid error: No such file or directory - pygmentize -l c -O encoding=utf-8 -f html</p>

<p>So this kinda hurt my head when I was first looking at all of this. In <code>main.m</code>, before the application starts, I swizzle the <code>UINavigationBar</code> methods. <code>method_exchangeImplementations()</code> switches my <code>drawRectCustomBackground:</code> with <code>drawRect:</code> in
<code>UINavigationBar</code>. When I call the default implementation in <code>drawRectCustomBackground:</code>, it looks like I'm calling the same method, but I am actually calling the default implementation because it swapped them.</p>

<p>This is pretty crazy and a little confusing (especially with someone new to Objective-C), but really powerful. You can use this approach to customize a lot of things Apple didn't intend for you to mess with. Go out and make something cool!</p>

  </div>
</div>



    </div>
    <div id="footer" class="wrapper">
    	<p class="clear">
    	    <span>Copyright <a href="/">Sam Soffes</a> 2005-2010.</span>
    	    <span><a href="http://github.com/samsoffes/samsoff.es" target="_blank" rel="external nofollow">View source on GitHub</a>.</span>
      </p>
    </div>
  </body>
</html>
